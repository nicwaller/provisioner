---
driver:
  name: ec2
  aws_ssh_key_id: "test-kitchen" # managed by configure.sh
  security_group_ids: [ "sg-012255f4fe60e5ac8" ] # managed by configure.sh
  region: us-west-2
  subnet_id: "subnet-09b7b37a4b506a13e" # managed by configure.sh
  instance_type: t3.nano
  associate_public_ip: true
  interface: public

transport:
  ssh_key: id_rsa
  username: ubuntu

lifecycle:
  post_create:
    - remote: |
        sudo apt-get -y update
        sudo apt-get -y install ruby
  pre_converge:
    - local: |
        set -x
        mkdir stage
        (cd ../provisioner && rm dist/provisioner.pyz && make dist/provisioner.pyz)
        cp ../provisioner/dist/provisioner.pyz stage/provisioner.pyz

provisioner:
  name: shell
  data_path: "stage/"
  root_path: "/home/ubuntu/"
  command: "cd /home/ubuntu/data && sudo python3 provisioner.pyz"

platforms:
  - name: ubuntu-18.04
  - name: ubuntu-20.04

verifier:
  name: inspec

suites:
  - name: default
